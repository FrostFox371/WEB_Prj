<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotels List</title>
</head>
<body>
    <h1>Hotels List</h1>

    <!-- Форма с фильтрами -->
    <form id="filterForm" action="/get_hotels" method="get">
        <label for="countrySelect">Страна:</label>
        <select id="countrySelect" name="country" autocomplete="country">
            <option value="">Выберите страну</option>
            <!-- Опции стран будут добавлены с помощью JavaScript -->
        </select>
        <br>
        <label for="citySelect">Город:</label>
        <select id="citySelect" name="city">
            <option value="">Выберите город</option>
            <!-- Опции городов будут добавлены с помощью JavaScript -->
        </select>
        <br>
        <button type="submit">Применить фильтр</button>
    </form>

    <hr>

    <!-- Список отелей -->
    <ul>
        {% for hotel in hotels %}
            <li>{{ hotel.name }} - {{ hotel.address }}</li>
        {% endfor %}
    </ul>

    <!-- JavaScript для добавления опций в выпадающие списки -->
    <script>
        // Функция для добавления опций в выпадающий список
        function addOptions(selectElement, options) {
            for (let option of options) {
                let optionElement = document.createElement("option");
                optionElement.value = option;
                optionElement.text = option;
                selectElement.appendChild(optionElement);
            }
        }

        // Запрос для получения списка стран и добавление их в выпадающий список
        fetch('/get_countries')
            .then(response => response.json())
            .then(countries => {
                const countrySelect = document.getElementById('countrySelect');
                addOptions(countrySelect, countries);
            });

        // Обработчик изменения выбранной страны
        document.getElementById('countrySelect').addEventListener('change', function() {
            const selectedCountry = this.value;
            const citySelect = document.getElementById('citySelect');

            // Очистка списка городов перед добавлением новых
            citySelect.innerHTML = '<option value="">Выберите город</option>';

            // Если страна не выбрана, завершаем выполнение
            if (!selectedCountry) return;

            // Запрос для получения списка городов выбранной страны и добавление их в выпадающий список
            fetch('/get_cities?country=${selectedCountry}')
                .then(response => response.json())
                .then(cities => addOptions(citySelect, cities));
        });
    </script>
</body>
</html>